var editor;var mode;var textarea;var zeditor={ready:function(){textarea=document.getElementById('editor-textarea');qreply=document.getElementById('quick_reply');$('.h3:contains("Quick reply:")').remove();editor=document.getElementById('zd-editor-form');mode=document.getElementById('editor-mode');editor.tid.value=qreply.tid.value;editor.t.value=qreply.t.value;editor.lt.value=qreply.lt.value;editor.notify.value=qreply.notify.value;zeditor.button()},load:function(){$(post+' a[href*="quote"], '+post+' a[href*="editpost"]').click(function(a){$('#zd-edit').load(this.href+' textarea:last',function(){textarea.value=this.firstChild.value;textarea.focus()});a.preventDefault()})},button:function(){a=(version=='punbb'||version=='phpbb3')?'.post':'.post.clearfix';$(a).each(function(){var id=$(this).find(post+' a[href*="quote"]').attr('href').split('p=')[1].replace('&mode=quote','');$(this).find(post+' a[href*="quote"]').attr('onclick','zeditor.start(\'quote\', \''+id+'\')');$(this).find(post+' a[href*="quote"]').before('<a class="editor-reply" href="#reply" onclick="zeditor.start(\'reply\', \''+id+'\')">'+reply_button+'</a>');$(this).find(post+' a[href*="editpost"]').attr('onclick','zeditor.start(\'edit\', \''+id+'\')')});zeditor.load()},add:function(x,y){textarea.focus();selix.wrap(textarea,x,y,true)},find:function(a){a=a.substring(a.indexOf("<a href=")+9);b=a.indexOf('"');return a.substring(0,b)},newpost:function(a){var b=a.split('#')[1];document.getElementById('zd-editor').style.display='none';if(mode.innerHTML==reply_text||mode.innerHTML==quote_text){$('<div class="newreply"></div>').insertAfter('.post:last').load(a+" #p"+b,function(){zeditor.button();$('.newreply').hide().fadeIn('2000')})}if(mode.innerHTML==edit_text){$("#zd-editor").parents(post_body).find(post_inbody).load(a+" #p"+b+" "+post_body+" "+post_inbody,function(){$("#zd-editor").parents(post_body).hide().fadeIn('slow');zeditor.button()})}textarea.value='';editor.lt.value=b},preview:function(){preview=document.getElementById('zd-preview');if(preview.style.display=='block'){preview.style.display='none'}else{var form=$("form[name='zd-editor']").serialize()+"&preview=1";$.post('/post',form,function(data){preview.style.display='block';preview.innerHTML=$(data).find(post_body).html()})}},post:function(){$.post('/post',$("form[name='zd-editor']").serialize()+'&post=1',function(c){if(c.indexOf("Flood control")>0){alert('B?n chua g?i du?c do b?n v?a g?i m?t bài cách dây không lâu.')}else if(c.indexOf('A new message')>0){$.post('/post',$(c).find("form[name='post']").serialize()+'&post=1',function(c){var a=c.indexOf("has been sent"),e=c.indexOf("entered successfully");0<a||0<e?(c=c.substring(0<a?a:e),c=zeditor.find(c),zeditor.newpost(c)):(alert('Error! please press F5'))})}else{if($("html").attr("xml:lang")=="en"){var a=c.indexOf("has been sent"),e=c.indexOf("entered successfully");0<a||0<e?(c=c.substring(0<a?a:e),c=zeditor.find(c),zeditor.newpost(c)):(alert('Error! please press F5'))}else if($("html").attr("xml:lang")=="vi"){var a=c.indexOf("B?m chu?t");0<a?(c=c.substring(a),c=zeditor.find(c),zeditor.newpost(c)):(alert('Có l?i vui l?ng ?n F5'))}}})},start:function(a,b){eid=document.getElementById('p'+b);$('#zd-editor').appendTo($(eid).find(post_body));document.getElementById('zd-editor').style.display='block';switch(a){case"reply":if(mode.innerHTML==edit_text){textarea.value='';editor.mode.value='reply';editor.p.value=''}mode.innerHTML=reply_text;break;case"quote":mode.innerHTML=quote_text;textarea.value=loading_text;break;case"edit":mode.innerHTML=edit_text;editor.mode.value='editpost';editor.p.value=b;textarea.value=loading_text;break;case"preview":mode.innerHTML=preview_text;break}},popup:function(a,b){$('#'+b).siblings().hide();x=document.getElementById(b);if(x.style.display=='none'){x.style.display='block'}else{x.style.display='none'}a.getAttribute('id')==null?a.id='editor-button-active':a.removeAttribute('id');switch(b){case"zd-color":var c='<table cellspacing="0" id="ddcbcolors">';var colors=new Array('00','33','66','99','CC','FF');for(i=5;i>=0;i--){c=c+'<tr>';for(j=5;j>=0;j--){for(k=5;k>=0;k--){var col=colors[j]+colors[i]+colors[k];c=c+'<td style="background: #'+col+'" title="'+col+'"><div style="background:#'+col+'" onclick="zeditor.add(\'[color=#'+col+']\', \'[/color]\');zeditor.color(this, \'hide\')" onmouseover="zeditor.color(this)"></div></td>'}}c=c+'</tr>'}document.getElementById('zd-color').innerHTML=c+'</table>';break;case"zd-smiley":smiley=document.getElementById('zd-smiley');if(smiley.innerHTML==''){$(smiley).load('/smilies.forum?mode=smilies_frame a',function(){this.innerHTML=this.innerHTML.replace(/emoticonp/g,'zeditor.smiley')})}break}},color:function(a,b){document.getElementById('editor-color').setAttribute('style',a.getAttribute("style"));if(b=='hide'){document.getElementById('zd-color').setAttribute('style','display:none')}},smiley:function(a){textarea.value+=a;textarea.focus();document.getElementById('zd-smiley').style.display='none'},tag:function(a){version=='punbb'||version=='phpbb3'?(version=='punbb'?(b=custom_tag,c=custom_tag1):(b='.post',c='.postprofile')):(b='.post.online',c='.postprofile-details.postdetails');var e=$(a).parents(b).find(c+' a[href^="/u"]').has('span');document.getElementById('editor-textarea').value+='[url='+location.host+$(e).attr('href')+']'+$(e).text()+'[/url]'},};document.write('<div id="zd-editor" style="display:none"><div id="zd-edit" style="display:none"></div><form id="zd-editor-form" name="zd-editor" method="post" action="/post"><div id="editor-top"><div id="editor-tool"><a onclick="zeditor.add(\'[b]\',\'[/b]\')" class="editor-button-outer" title="Bold"><span id="editor-bold" class="editor-button">&nbsp;</span></a><a onclick="zeditor.add(\'[i]\',\'[/i]\')"  class="editor-button-outer" title="Italic"><span id="editor-italic" class="editor-button">&nbsp;</span></a><a onclick="zeditor.add(\'[u]\',\'[/u]\')"  class="editor-button-outer" title="Underline"><span id="editor-underline" class="editor-button">&nbsp;</span></a><a onclick="zeditor.add(\'[strike]\',\'[/strike]\')"  class="editor-button-outer" title="Strike"><span id="editor-strike" class="editor-button">&nbsp;</span></a>
<a class="editor-button-outer" title="Color" onclick="zeditor.popup(this, \'zd-color\')"><span id="editor-color" class="editor-button"></span></a>
<a class="editor-button-outer" title="Color" onclick="zeditor.popup(this, \'zd-smiley\')"><span id="editor-smiley" class="editor-button"></span></a><a class="editor-button-outer" title="Tag" onclick="zeditor.tag(this)"><span id="editor-tag" class="editor-button"></span></a><div><div id="zd-color" style="display:none"></div><div id="zd-smiley" style="display:none"></div></div></div></div><div id="outer-preview"><div id="zd-preview" ondblclick="$(this).hide()"></div><textarea name="message" id="editor-textarea" style="position: relative; width: 100%; height: 98%;"></textarea></div><div id="editor-data"><input type="hidden" value="" name="attach_sig"><input type="hidden" value="reply" name="mode"><input type="hidden" value="" name="tid"><input type="hidden" value="" name="t"><input type="hidden" value="" name="lt"><input type="hidden" value="" name="notify"><input type="hidden" value="" name="p"></div><div id="editor-post-tool"><div id="editor-post-button"><input onclick="zeditor.preview();return false" id="editor-preview-button" value="Preview" name="preview" type="submit" /><input type="submit" value="Send" name="post"  id="editor-send-button" onclick="zeditor.post();return false"></div><div id="editor-mode"></div></div></form></div>');$(function(){zeditor.ready()});